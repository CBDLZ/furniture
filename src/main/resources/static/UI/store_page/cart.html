<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>首页</title>
    <link rel="stylesheet" href="../lib/layui-v2.6.3/css/layui.css" media="all">
    <link rel="stylesheet" href="css/style2.css">
    <script src="../lib/layui-v2.6.3/layui.js" charset="utf-8"></script>

    <link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap.min.css">
    <script src="../js/jquery-1.9.1.min.js"></script>
    <script src="bootstrap/js/bootstrap.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" src="../js/jquery-getUrlParam.js"></script>

    <!--导入核心文件-->
    <script src="bootstrap3/js/holder.js"></script>
    <link href="bootstrap3/css/bootstrap.css" rel="stylesheet" type="text/css">

    <link rel="stylesheet" type="text/css" href="css/cart.css" />
</head>

    <style>
        h1{
            text-align: center;
        }
        .logo{
            font-size: 1.5em;
        }
        .share{
            float: right;
        }
        body{
            background: #f5f5f5;
        }
        a{
            text-decoration: none;
            color: #0C0C0C;
        }
        a:hover{
            text-decoration: none;
            color: #0C0C0C;
        }
        .box {
            margin: 10px;
            column-count: 4;
            column-gap: 30px;
        }
        .first-pic{

        }
        .scroll-pic img{
        width: 100%;

        }
        .form-space{
            margin-top: 20px;
        }
        .product-form {
            margin-top: 20px;
        }

        .price-bar{

            font-size: 15px;

        }
        #product-price {
            font-size: 25px;
        }

        .product-details img{
            margin-top: 20px;
            width: 100%;
        }

    </style>

<body>
<div class="layui-row">
    <div class="layui-col-md12" style="height: 60px">
        <ul class="layui-nav layui-bg-green" style="margin: 0px">
            <li class="layui-nav-item"><a style="text-decoration: none;" class="logo" href="">个性化家居</a></li>
            <li class="layui-nav-item"><a style="text-decoration: none;" href="">首页</a></li>
            <li class="layui-nav-item"><a style="text-decoration: none;" href="product_list.html">所有家居</a></li>
            <li class="layui-nav-item"><a style="text-decoration: none;" href="hot.html">灵感分享</a></li>
            <li class="layui-nav-item"><a style="text-decoration: none;" href="">家居定制</a></li>
            <li class="layui-nav-item"><a style="text-decoration: none;" href="../index.html">个人中心</a></li>
            <li class="layui-nav-item share"><a style="text-decoration: none;" href=""> <i class="layui-icon layui-icon-login-wechat"style="font-size: 30px;"></i></a></li>
            <li class="layui-nav-item share"><a style="text-decoration: none;" href=""> <i class="layui-icon layui-icon-login-qq"style="font-size: 30px;"></i></a></li>
            <li class="layui-nav-item share"><a style="text-decoration: none;" href=""> <i class="layui-icon layui-icon-login-weibo"style="font-size: 30px;"></i></a></li>

        </ul>
    </div>
</div>
<br>
<h1>商品详情</h1>
<div class="layui-container">
    <div class="layui-row">
        <div class="container">
            <div class="col-md-offset-1 col-md-10">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <p class="panel-title"><span class="fa fa-shopping-cart"></span> 购物车</p>
                    </div>
                    <div class="panel-body">
                        <form action="order.html" role="form">
                            <!--购物车表格开始-->
                            <table class="cart-table" width="100%">
                                <thead>
                                <tr>
                                    <th width="8%">
                                        <input type="checkbox" class="ckall" onclick="checkall(this)" />全选</th>
                                    <th width="110"></th>
                                    <th width="29%">商品</th>
                                    <th width="11%">单价</th>
                                    <th width="15%">数量</th>
                                    <th width="11%">金额</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody id="cart-list" class="cart-body">
                                <tr>
                                    <td>
                                        <input type="checkbox" name="cids" value="1" class="ckitem" />
                                    </td>
                                    <td><img src="images/product_pics/1/1.avif" class="img-responsive" /></td>
                                    <td>联想(Lenovo)小新Air13 Pro 13.3英寸14.8mm超轻薄笔记本电脑</td>
                                    <td>¥<span id="goodsPrice1">5298</span></td>
                                    <td>
                                        <input type="button" value="-" class="num-btn" onclick="reduceNum(1)" />
                                        <input id="goodsCount1" type="text" size="2" readonly="readonly" class="num-text" value="1">
                                        <input class="num-btn" type="button" value="+" onclick="addNum(1)" />
                                    </td>
                                    <td><span id="goodsCast1"></span></td>
                                    <td>
                                        <input type="button" onclick="delCartItem(this)" class="cart-del btn btn-default btn-xs" value="删除" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <input type="checkbox" value="2" class="ckitem" />
                                    </td>
                                    <td><img src="images/product_pics/1/2.avif" class="img-responsive" /></td>
                                    <td>戴尔(DELL)XPS13-9360-R1609 13.3</td>
                                    <td>¥<span id="goodsPrice2">4988</span></td>
                                    <td>
                                        <input type="button" value="-" class="num-btn" onclick="reduceNum(2)" />
                                        <input id="goodsCount2" type="text" size="2" readonly="readonly" class="num-text" value="1">
                                        <input class="num-btn" type="button" value="+" onclick="addNum(2)" />
                                    </td>
                                    <td><span id="goodsCast2"></span></td>
                                    <td>
                                        <input type="button" onclick="delCartItem(this)" class="cart-del btn btn-default btn-xs" value="删除" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <input type="checkbox"  value="3" class="ckitem" />
                                    </td>
                                    <td><img src="../images/portal/13LenovoIdeaPad310_silvery/collect.png" class="img-responsive" /></td>
                                    <td>戴尔(DELL)魔方15MF Pro-R2505TSS灵越</td>
                                    <td>¥<span id="goodsPrice3">4699</span></td>
                                    <td>
                                        <input type="button" value="-" class="num-btn" onclick="reduceNum(3)" />
                                        <input id="goodsCount3" type="text" size="2" readonly="readonly" class="num-text" value="1">
                                        <input class="num-btn" type="button" value="+" onclick="addNum(3)" />
                                    </td>
                                    <td><span id="goodsCast3"></span></td>
                                    <td>
                                        <input type="button" onclick="delCartItem(this)" class="cart-del btn btn-default btn-xs" value="删除" />
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                            <div class="total-bar">
                                <a href="javascript:selDelCart()" class="cart-del-sel btn btn-default btn-xs">删除所选商品</a>
                                <span class="pull-right">已选商品
								<span id="selectCount">0</span>件 总价¥
								<span id="selectTotal">0</span>元
								</span>
                            </div>
                            <div>
								<span class="pull-right">
								<input type="submit" value="  结  算  " class="btn btn-primary btn-lg link-account" />
							</span>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
    $(function() {
        //返回链接
        $(".link-account").click(function() {
            location.href = "order.html";
        })
    })
    $(document).ready(function() {
        showCartList();
    });

    function showCartList() {
        $("#cart-list").empty();
        $.ajax({
            url: "/carts",
            type: "GET",
            dataType: "JSON",
            success: function(json) {
                let list = json.data;
                for (let i = 0; i < list.length; i++) {
                    let tr = '<tr>'
                        + '<td>'
                        + 	'<input name="cids" value="#{cid}" type="checkbox" class="ckitem" />'
                        + '</td>'
                        + '<td><img id="img_#{pid}" src="#{image}" class="img-responsive" /></td>'
                        + '<td>#{title}#{sell_point}</td>'
                        + '<td>¥<span id="price-#{cid}">#{realPrice}</span></td>'
                        + '<td>'
                        + 	'<input type="button" value="-" class="num-btn" onclick="reduceNum(#{cid})" />'
                        + 	'<input id="num-#{cid}" type="text" size="2" readonly="readonly" class="num-text" value="#{num}">'
                        + 	'<input class="num-btn" type="button" value="+" onclick="addNum(#{cid})" />'
                        + '</td>'
                        + '<td>¥<span id="total-price-#{cid}">#{totalPrice}</span></td>'
                        + '<td>'
                        + 	'<input type="button" onclick="delCartItem(this)" class="cart-del btn btn-default btn-xs" value="删除" />'
                        + '</td>'
                        + '</tr>';
                    tr = tr.replace(/#{cid}/g, list[i].cid);
                    tr = tr.replace(/#{title}/g, list[i].title);
                    tr = tr.replace(/#{sell_point}/g, list[i].sellPoint);
                    // tr = tr.replace(/#{image}/g, list[i].image);
                    tr = tr.replace(/#{pid}/g, list[i].pid);
                    tr = tr.replace(/#{realPrice}/g, list[i].realPrice);
                    tr = tr.replace(/#{num}/g, list[i].num);
                    tr = tr.replace(/#{totalPrice}/g, list[i].realPrice * list[i].num);


                    $("#cart-list").append(tr);
                }
                findPic();
            }
        });
    }

    function findPic(){
        //获取商品详情图片
        $.ajax({
            url: "/picture/0/0/find_pics",
            type: "GET",
            dataType: "JSON",
            sync:false,
            success: function (json) {

                let list = json.data;
                console.log("count=" + list.length);
                for (let i = 0; i < list.length; i++) {
                    console.log(list[i].path);
                    console.log("#img_"+list[i].productId);
                    $("#img_"+list[i].productId).attr("src", "/file/" + list[i].path);
                }
            }
        });
    }
    function addNum(cid) {
        var n = parseInt($("#num-"+cid).val());
        $("#num-"+cid).val(n + 1);
        calcRow(cid);
        numChange(cid);
    }
    /*按减号数量减*/
    function reduceNum(cid) {
        var n = parseInt($("#num-"+cid).val());
        if (n == 0)
            return;
        $("#num-"+cid).val(n - 1);
        calcRow(cid);
        numChange(cid);
    }
    function calcRow(cid) {
        //取单价
        var vprice = parseFloat($("#price-"+cid).html());
        console.log($("#price-"+cid).html());
        //取数量
        var vnum = parseFloat($("#num-"+cid).val());
        console.log(vnum);
        //小计金额
        var vtotal = vprice * vnum;
        //赋值
        $("#total-price-"+cid).html(vtotal);
    }
    function numChange(cid) {
        $.ajax({
            url: "/carts/" + cid + "/num/add",
            data: "num="+$("#num-"+cid).val(),
            type: "POST",
            dataType: "JSON",
            success: function(json) {
                if (json.state == 200) {
                    // alert("增加商品数量成功！" + json.message);
                } else {
                    alert("增加商品数量失败！" + json.message);
                }
            },
            error: function(xhr) {
                alert("您的登录信息已经过期，请重新登录！HTTP响应码：" + xhr.status);
                location.href = "login.html";
            }
        });
    }
</script>
</body>

