<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>首页</title>
    <link rel="stylesheet" href="../lib/layui-v2.6.3/css/layui.css" media="all">
    <link rel="stylesheet" href="css/style2.css">
    <script src="../lib/layui-v2.6.3/layui.js" charset="utf-8"></script>

    <link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap.min.css">
    <script src="../js/jquery-1.9.1.min.js"></script>
    <script src="bootstrap/js/bootstrap.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" src="../js/jquery-getUrlParam.js"></script>
</head>

    <style>
        h1{
            text-align: center;
        }
        .logo{
            font-size: 1.5em;
        }
        .share{
            float: right;
        }
        body{
            background: #f5f5f5;
        }
        a{
            text-decoration: none;
            color: #0C0C0C;
        }
        a:hover{
            text-decoration: none;
            color: #0C0C0C;
        }
        .box {
            margin: 10px;
            column-count: 4;
            column-gap: 30px;
        }
        .first-pic{

        }
        .scroll-pic img{
        width: 100%;

        }
        .form-space{
            margin-top: 20px;
        }
        .product-form {
            margin-top: 20px;
        }

        .price-bar{

            font-size: 15px;

        }
        #product-price {
            font-size: 25px;
        }

        .product-details img{
            margin-top: 20px;
            width: 100%;
        }

    </style>

<body>
<div class="layui-row">
    <div class="layui-col-md12" style="height: 60px">
        <ul class="layui-nav layui-bg-green" style="margin: 0px">
            <li class="layui-nav-item"><a style="text-decoration: none;" class="logo" href="">个性化家居</a></li>
            <li class="layui-nav-item"><a style="text-decoration: none;" href="">首页</a></li>
            <li class="layui-nav-item"><a style="text-decoration: none;" href="product_list.html">所有家居</a></li>
            <li class="layui-nav-item"><a style="text-decoration: none;" href="hot.html">灵感分享</a></li>
            <li class="layui-nav-item"><a style="text-decoration: none;" href="">家居定制</a></li>
            <li class="layui-nav-item"><a style="text-decoration: none;" href="../index.html">个人中心</a></li>
            <li class="layui-nav-item share"><a style="text-decoration: none;" href=""> <i class="layui-icon layui-icon-login-wechat"style="font-size: 30px;"></i></a></li>
            <li class="layui-nav-item share"><a style="text-decoration: none;" href=""> <i class="layui-icon layui-icon-login-qq"style="font-size: 30px;"></i></a></li>
            <li class="layui-nav-item share"><a style="text-decoration: none;" href=""> <i class="layui-icon layui-icon-login-weibo"style="font-size: 30px;"></i></a></li>

        </ul>
    </div>
</div>
<br>
<h1>商品详情</h1>
<div class="layui-container">
    <div class="layui-row">
        <div class="layui-carousel layui-col-md6 first-pic" id="test1">
            <div carousel-item class="scroll-pic" id="scroll-pic">
                <div><img src="images/product_pics/1/1.avif"></div>
                <div><img src="images/product_pics/1/2.avif"></div>
                <div><img src="images/product_pics/1/3.avif"></div>
                <div><img src="images/product_pics/1/4.avif"></div>
            </div>
        </div>
        <div class="layui-col-md4 layui-col-md-offset1">
            <h3 id="product-title" class="col-md-12">戴尔Dell 燃700R1605银色</h3>
            <p id="product-sell-point" class="col-md-12"><small>仅上海，广州，沈阳仓有货！预购从速！</small></p>
            <div class="col-md-12 price-bar">
                <small>学员售价：</small> ¥<span id="product-price">4899.00</span>
                <div><small>*退货补运费 *7天无理由退货 *24小时快速退款 </small></div>
            </div>
            <form class="form-inline product-form col-md-12" role="form">
                <div class="col-md-12 form-space">
                    <label for="num">数量：</label>
                    <input id="numDown" type="button" value="-" class="num-btn" />
                    <input id="num" type="text" size="2" readonly="readonly" class="num-text" value="1">
                    <input id="numUp" class="num-btn" type="button" value="+" />
                </div>
                <div class="col-md-12 form-space">
                    <p><small>发货并提供售后服务,今日下单,明日送达</small></p>
                </div>
                <div class="col-md-6 form-space ">
                    <input class="btn btn-primary btn-lg btn-block" type="button" value="立即购买">
                </div>
                <div class="col-md-12 form-space">
                    <button id="btn-add-to-cart" type="button" class="btn btn-default go-cart"><span class="fa fa-cart-plus"></span> 加入购物车</button>
                    <button id="btn-add-to-collect" type="button" class="btn btn-default"><span class="fa fa-heart-o"></span> 加入收藏</button>
                </div>
            </form>
        </div>
    </div>
    <div class="layui-row " id="product-details-list">
        <div class="layui-col-md-offset1 layui-col-md10 product-details" >
            <img src="images/product_pics/1/1_1.webp">
        </div>
        <div class="layui-col-md-offset1 layui-col-md10 product-details" >
            <img src="images/product_pics/1/1_2.webP">
        </div>
        <div class="layui-col-md-offset1 layui-col-md10 product-details" >
            <img src="pic2/lg1.jpg">
        </div>
        <div class="layui-col-md-offset1 layui-col-md10 product-details" >
            <img src="pic2/lg3.jpg">
        </div>
    </div>
</div>

<script>
    layui.use(['carousel'], function(){
        var carousel = layui.carousel;


        let pid = $.getUrlParam("id");

            console.log("pid=" + pid);

        $(document).ready(function() {

            //获取轮播图
            $.ajax({
                url: "/picture/"+ pid +"/1/find_pics",
                type: "GET",
                dataType: "JSON",
                success: function(json) {
                    if (json.state == 200) {
                        let list = json.data;
                        $("#scroll-pic").empty();
                        for (let i = 0; i < list.length; i++) {
                            let html = '<div><img src="#{path}"></div>';
                            html = html.replace(/#{path}/g, "/file/" + list[i].path);
                            console.log(html);
                            $("#scroll-pic").append(html);
                        }

                        //常规轮播
                        carousel.render({
                            elem: '#test1'
                            ,arrow: 'always'
                            ,width: '600px'
                            ,height: '600px'
                        });
                    } else if (json.state == 4006) { // 商品数据不存在的异常
                        location.href = "index.html";
                    } else {
                        alert("获取商品信息失败！" + json.message);
                    }
                }
            });
            //获取商品详情图片
            $.ajax({
                url: "/picture/"+ pid +"/2/find_pics",
                type: "GET",
                dataType: "JSON",
                success: function(json) {
                    if (json.state == 200) {
                        let list = json.data;
                        $("#product-details-list").empty();
                        for (let i = 0; i < list.length; i++) {
                            let html = '<div class="layui-col-md-offset1 layui-col-md10 product-details" >\n' +
                                '            <img src="#{path}">\n' +
                                '        </div>';
                            html = html.replace(/#{path}/g, "/file/" + list[i].path);
                            console.log(html);
                            $("#product-details-list").append(html);
                        }
                    } else if (json.state == 4006) { // 商品数据不存在的异常
                        location.href = "index.html";
                    } else {
                        alert("获取商品信息失败！" + json.message);
                    }
                }
            });

            $.ajax({
                url: "/products/" + pid + "/get_product",
                type: "GET",
                dataType: "JSON",
                success: function(json) {
                    if (json.state == 200) {
                        console.log("title=" + json.data.title);
                        $("#product-title").html(json.data.title);
                        $("#product-sell-point").html(json.data.sellPoint);
                        $("#product-price").html(json.data.price);


                    } else if (json.state == 4006) { // 商品数据不存在的异常
                        location.href = "index.html";
                    } else {
                        alert("获取商品信息失败！" + json.message);
                    }
                }
            });
        });

        // 购物车添加按钮点击
        $("#btn-add-to-cart").click(function() {
            $.ajax({
                url: "/carts/add_to_cart",
                type: "POST",
                data: {
                    "pid": pid,
                    "amount": $("#num").val()
                },
                dataType: "JSON",
                success: function(json) {
                    if (json.state == 200) {
                        alert("增加成功！");
                        location.href = "cart.html";
                    } else {
                        alert("增加失败！" + json.message);
                    }
                },
                error: function(xhr) {
                    alert("您的登录信息已经过期，请重新登录！HTTP响应码：" + xhr.status);
                    location.href = "login.html";
                }
            });
        });

        //购物数量加1
        $("#numUp").click(function() {
            var n = parseInt($("#num").val());
            $("#num").val(n + 1);
        })
        //购物数量-1
        $("#numDown").click(function() {
            var n = parseInt($("#num").val());
            if (n == 1) {
                return;
            }
            $("#num").val(n - 1);
        })

    });


</script>
</body>

